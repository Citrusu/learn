<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body{
            padding: 20px;
        }
        .left{
            text-align: left;
        }
        .right{
            text-align: right;
            float: right;
            clear: both;
            background-color: #78a2d6;
            color: #fff;
        }
        ul{
            width: 300px;
            border: 1px solid #ddd;
            height: 400px;
            overflow-y: scroll;
            padding: 0;
        }
        li{
            list-style: none;
            float: left;
            clear: both;
            padding: 3px 5px;
            border: 1px solid #ccc;
            margin: 5px;
            border-radius: 10px;
        }
        textarea{
            width: 300px;
            height: 50px;
            padding: 5px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
<h1>hello</h1>
<ul id="msgBox"></ul>
<textarea name="" id="inputBox" cols="30" rows="10"></textarea>
<button id="sendBtn">发送</button>
<script>
    let url = 'ws://localhost:3000';
    let socket = new WebSocket(url);

    console.log("Clinet is running...");

    let msgBox = document.querySelector('#msgBox');

    socket.onmessage = function(event){
        //console.log(event);
        //显示来自服务器的消息
        let msgItem = document.createElement('li');
        msgItem.innerText = event.data;
        msgBox.appendChild(msgItem);
    };

    socket.onopen = function(event){
        console.log("websocket is open");
        let inputBox = document.querySelector('#inputBox');
        document.querySelector('#sendBtn').addEventListener('click', function(){
            let val = inputBox.value;
            socket.send(val);
            //显示自己的消息
            let msgItem = document.createElement('li');
            msgItem.innerText = val;
            msgItem.setAttribute('class', 'right');
            msgBox.appendChild(msgItem);
            inputBox.value = '';
        })

    };

    socket.onerror = function(event){
        console.log("websocket create failed");
    };

    window.onbeforeunload = function(){
        socket.send("Client is Leaving");
        return "Are you sure";
    };
</script>
</body>
</html>